define(["app/model/util","app/model/responsiveness","jquery","bootstrap"],function(e,t,n){function r(){var e,t,r,u=n(window),f=i.scrollTop(),l=0,c=0;i.find("main > article").find("section").each(function(){return e=n(this),e.offset().top>f?(t=s.find('a[href="#'+e.attr("id")+'"]'),r=t.parent("li"),s.data("oldActiveItems")&&s.data("oldActiveItems").removeClass("active"),s.data("oldActiveItems",t.parents("li").addClass("active")),c=t.offset().top,l=f+u.height()-c-t.height()-15,0>l?s.children("ul").css("top",l):f>c&&s.children("ul").css("top",f-c),!1):void 0})}if(!(n(window).width()<t.desktop.width)){var i=n(document),s=n('<nav class="col-lg-2 col-md-3 hidden-xs hidden-sm"/>');i.on("scroll.ui.an",function(){e.throttle(r)}).ready(function(){var e=i.find("main > article"),t=function(e){var r=n('<ul class="list-unstyled"/>'),i=n("<li/>"),s=e.children("h1,h2,h3,h4,h5,h6").text(),o="chapter-"+s.replace(/\W/g,"");return r.append(i),i.append(n("<a/>").attr("href","#"+o).text(s)),e.attr("id",o),e.children("section").each(function(){i.append(t(n(this)))}),r};e.children("section").each(function(){s.append(t(n(this).addClass("col-lg-10 col-md-9")))}).end().append(s),console.log(i.height()-e.offset().top-e.height()),s.children("ul").affix({offset:{top:s.offset().top,bottom:i.height()-e.offset().top-e.height()}}).on("affixed-top.bs.affix",function(){n(this).css("top","")}),r()})}});