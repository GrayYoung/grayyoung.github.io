require(["./config"],function(config){require(["app/controller/global"]);require(["app/model/requests","app/model/util","app/model/excelRequest","jquery","bootstrap","xlsx"],function(requests,util,excelRequest,$){$(document).on("click","#containerListing a.u-url",function(event){var cvsContext,$this=$(this),$preview=$this.closest(".h-item"),$modal=$("#modalPreview"),imdbData=$preview.data("imdbData"),total=parseInt($("#fixedProgress .progress-label").text(),10),current=$preview.index(),leftLimited=1>current,rightLimited=current>total-2,img=new Image;if(0===$modal.size()){$modal=$(document.getElementById("tl-modalPreview").content).children().clone();$modal.on("hidden.bs.modal",function(event){$(this).remove()}).insertAfter($this).modal("show")}$modal.find(".loading").toggleClass("active",!0);$modal.find(".carousel-control").off("click").one("click",function(event){var $arrow=$(this);$preview[function(){return $arrow.hasClass("left")?"prev":($arrow.hasClass("right"),"next")}()]().find("a.u-url").click();event.preventDefault()}).filter(".left").toggleClass("disabled",leftLimited).children(".fa").toggleClass("fa-angle-left",!leftLimited).toggleClass("fa-minus",leftLimited).end().end().filter(".right").toggleClass("disabled",rightLimited).children(".fa").toggleClass("fa-angle-right",!rightLimited).toggleClass("fa-minus",rightLimited);$modal.find(".modal-title").text(imdbData.Title).find(".modal-footer dd").text("");$.each(imdbData,function(key,value){$modal.find(".modal-footer .p-"+key.toLowerCase()).text(value)});canvas=$modal.find("#posterCanvas").get(0);cvsContext=canvas.getContext("2d");cvsContext.clearRect(0,0,canvas.width,canvas.height);img.onerror=function(){var gradient=cvsContext.createLinearGradient(0,0,canvas.width,0);gradient.addColorStop(.125,"#f15441");gradient.addColorStop(.375,"#fec536");gradient.addColorStop(.625,"#69c4bd");gradient.addColorStop(.875,"#2b669f");cvsContext.fillRect(0,0,canvas.width,canvas.height);cvsContext.fillStyle=gradient;cvsContext.fill();$modal.find(".loading").toggleClass("active",!1)};img.onload=function(){canvas.width=this.width,canvas.height=this.height;cvsContext.drawImage(img,0,0);$modal.find(".loading").addClass("active");$modal.find(".loading").toggleClass("active",!1)};img.src=imdbData.Posters&&imdbData.Posters[0]||"http://grayyoung.github.io/Flickr/poster/"+imdbData.Title+".jpg";event.preventDefault()}).ready(function(){var $container=$("#containerListing"),listItems=function(workbook){var sheet=workbook&&workbook.Sheets[workbook.SheetNames[0]]||$container.data("sheet"),offset=$container.data("offset")||2,count=1,type=util.getUrlParam("t",!0),tPattern=new RegExp("^\\s*"+type+"\\s*$","i"),$p=$("#fixedProgress"),callData=($(".progress-label",$p),function(data){var $p=$("#fixedProgress"),$pLabel=$(".progress-label",$p),$preview=$(document.getElementById("tl-preview").content).children().clone().data("imdbData",data);$preview.find(".p-category").children().first().text(data.Type).end().last().text(data.Genre);$preview.find("img").attr("src",data.Poster).get(0).onerror=function(){this.src=data.Posters&&data.Posters[0]||"http://grayyoung.github.io/Flickr/poster/"+data.Title+".jpg";this.onerror=null};$preview.find(".p-name").children().text(data.Title);$preview.find(".p-rating").children().first().css("width",data.imdbRating+"em").next().children().first().text(data.imdbRating).next().text(data.imdbVotes);$preview.find(".u-url").attr("href","http://www.imdb.com/title/"+data.imdbID);$container.append($preview);$pLabel.text(parseInt($pLabel.text(),10)+1);count++}),iterateItem=function(sheet,index){var preview,oneAfterOne=arguments.callee;$container.data("offset",index);preview={Title:sheet["A"+index]&&sheet["A"+index].v,imdbID:sheet["B"+index]&&sheet["B"+index].v,Type:sheet["C"+index]&&sheet["C"+index].v,PosterList:sheet["D"+index]&&sheet["D"+index].v};if("undefined"===$.type(preview.Title)&&"undefined"===$.type(preview.imdbID)){$container.data("loading",!1);$p.toggleClass("loading",!1);$(window).unbind("scroll.ls.media");return!1}if(count>20){$container.data("loading",!1);$p.toggleClass("loading",!1);return!0}delete sheet["A"+index];delete sheet["B"+index];delete sheet["C"+index];delete sheet["D"+index];if(""===type||tPattern.test(preview.Type))if(preview.imdbID)$.ajax({url:requests.imdb,type:"get",data:{i:preview.imdbID,plot:"full",r:"json"},success:function(imdbData){preview.PosterList&&(imdbData.Posters=preview.PosterList.split(","));callData(imdbData)},error:function(){callData(preview)},complete:function(){oneAfterOne(sheet,index+1)}});else{callData(preview);oneAfterOne(sheet,index+1)}else oneAfterOne(sheet,index+1)};$container.data("sheet",sheet);iterateItem(sheet,offset)};$container.data({loading:!1});$(window).bind("scroll.ls.media",function(event){var $w=$(this),$p=$("#fixedProgress");if(!$container.data("loading")&&$container.height()+$container.offset().top<$w.scrollTop()+$w.height()){$container.data("loading",!0);$p.toggleClass("loading",!0);if($container.data("sheet"))listItems();else if(window.Worker){var xlsxWorker=new Worker("/dist/js/app/worker/xlsx.js");xlsxWorker.onmessage=function(event){listItems(event.data);xlsxWorker.terminate()};xlsxWorker.onerror=function(error){excelRequest("GET",requests.media,listItems);xlsxWorker.terminate()}}else excelRequest("GET",requests.media,listItems)}}).triggerHandler("scroll.ls.media")})})});define("../media",function(){});define("app/model/util",{hasEvent:function(type,events){var tmp=/^([^.]*)(?:\.(.+)|)$/.exec(type)||[],typeT=origType=tmp[1];return events&&events[typeT]&&function(){var breakFct=!1,namespace=(tmp[2]||"").split(".").sort().join(".");$.each(events[typeT],function(i,e){if(e.namespace===namespace){breakFct=!0;return!1}});return breakFct}()?!0:!1},getUrlParam:function(name,ignoreCase){function getRegExp(name){var pattern=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");ignoreCase===!0&&(pattern=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i"));return window.location.search.substr(1).match(pattern)}var r="";r=getRegExp(name);return null!=r?unescape(r[2]):""},setCookie:function(cname,cvalue,exdays,domain){var tempCookieStr=cname+"="+cvalue+";";if(exdays&&""!=exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toGMTString();tempCookieStr+=expires+";"}tempCookieStr+="path=/;";domain&&""!=domain&&(tempCookieStr+=domain+";");document.cookie=tempCookieStr},getCookie:function(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){var c=$.trim(ca[i]);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}});define("app/model/excelRequest",[],function(){return function(method,url,callback){var xhRequest;if(XMLHttpRequest)xhRequest=new XMLHttpRequest;else{if(!ActiveXObject)throw"XHR unavailable for your browser";xhRequest=new ActiveXObject("MSXML2.XMLHTTP.3.0")}xhRequest.open(method,url,!0);if("undefined"!=typeof Uint8Array){xhRequest.responseType="arraybuffer";xhRequest.onload=function(e){for(var arraybuffer=xhRequest.response,data=new Uint8Array(arraybuffer),arr=new Array,i=0;i!=data.length;++i)arr[i]=String.fromCharCode(data[i]);callback(XLSX.read(arr.join(""),{type:"binary"}))}}else{xhRequest.setRequestHeader("Accept-Charset","x-user-defined");xhRequest.onreadystatechange=function(){4==xhRequest.readyState&&200==xhRequest.status&&callback(XLSX.read(xhRequest.responseBody,{type:"binary"}))}}xhRequest.send();return xhRequest}});define("app/model/requests",{imdb:"http://www.omdbapi.com/",media:"/data/media.xlsx",work:"/data/work.xlsx"});define("app/controller/global",["app/model/requests","jquery","bootstrap","browser"],function(requests,$){$(document).ready(function(){$("#progressBar").toggleClass("active",!1);$.browser.msie?$("#tip-browser").removeClass("hidden"):$("#tip-browser").remove()});!function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-51330074-5","auto");ga("require","linkid");ga("send","pageview")});