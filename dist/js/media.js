require(["./config"],function(e){require(["app/controller/global"]);require(["app/model/util","app/model/requests","app/model/excelRequest","app/model/iterateMedia","jquery","bootstrap","xlsx"],function(e,t,n,o,a){function i(){var e,t,n,o=location.search.substr(1),i=1,s=/(^|\&)(page=[^\&]*)(\&|$)/gi,r=a(document),d=a("#containerListing"),c=r.scrollTop(),l=r.data("oddScrollTop"),f=a(window).height(),u=d.offset().top,p=d.height();l>c&&c<=u-Math.min(f,u)/2?d.trigger("update","top"):c>=l&&c>=u+p-f+Math.min(f,r.height()-u-p)/2&&d.trigger("update","bottom");r.data("oddScrollTop",c).find(".h-item").each(function(){e=a(this);t=e.offset().top,n=e.height();if(t+.75*n>c&&c+n>t){i=e.data("page")||d.data("originalpage");""!==o?s.test(o)?o=o.replace(s,"$1page="+i+"$3"):o+="&page="+i:o="page="+i;history.replaceState(null,null,location.pathname+"?"+o.replace(/(^|\&)(page=1)(\&|$)/gi,"$3").replace(/^\&+/g,""));return!1}})}a(document).on("mousewheel.ls.media",function(e){e.deltaY>0&&a(document).scrollTop()<=0?a("#containerListing").trigger("update","top"):e.deltaY<0&&a(document).scrollTop()>=a(document).height()-a(window).height()&&a("#containerListing").trigger("update","bottom")}).on("touchstart.ls.media",function(e){var t=a(this);t.data("touch",{pageX:e.originalEvent.changedTouches[0].pageX,pageY:e.originalEvent.changedTouches[0].pageY,startTime:(new Date).getTime()})}).on("touchend.ls.media",function(e){var t=a(this),n=t.data("touch"),o=e.originalEvent.changedTouches[0].pageY-n.pageY;(new Date).getTime()-n.startTime<=300&&(o>=60&&a(document).scrollTop()<=0?a("#containerListing").trigger("update","top"):60>=o&&a(document).scrollTop()>=a(document).height()-a(window).height()&&a("#containerListing").trigger("update","bottom"))}).on("click","#containerListing a.u-url",function(e){var t,n=a(this),o=n.closest(".h-item"),i=a("#modalPreview"),s=o.data("imdbData"),r=parseInt(a("#fixedProgress .progress-label").text(),10),d=o.index(),c=1>d,l=d>r-2,f=new Image;if(0===i.size()){i=a(document.getElementById("tl-modalPreview").content).children().clone();i.on("hidden.bs.modal",function(e){a(this).remove()}).insertAfter(n).modal("show")}i.find(".loading").toggleClass("active",!0);i.find(".carousel-control").off("click").one("click",function(e){var t=a(this);o[function(){return t.hasClass("left")?"prev":(t.hasClass("right"),"next")}()]().find("a.u-url").click();e.preventDefault()}).filter(".left").toggleClass("disabled",c).children(".fa").toggleClass("fa-angle-left",!c).toggleClass("fa-minus",c).end().end().filter(".right").toggleClass("disabled",l).children(".fa").toggleClass("fa-angle-right",!l).toggleClass("fa-minus",l);i.find(".modal-title").text(s.Title).find(".modal-footer dd").text("");a.each(s,function(e,t){i.find(".modal-footer .p-"+e.toLowerCase()).text(t)});canvas=i.find("#posterCanvas").get(0);t=canvas.getContext("2d");t.clearRect(0,0,canvas.width,canvas.height);f.onerror=function(){var e=t.createLinearGradient(0,0,canvas.width,0);e.addColorStop(.125,"#f15441");e.addColorStop(.375,"#fec536");e.addColorStop(.625,"#69c4bd");e.addColorStop(.875,"#2b669f");t.fillRect(0,0,canvas.width,canvas.height);t.fillStyle=e;t.fill();i.find(".loading").toggleClass("active",!1)};f.onload=function(){canvas.width=this.width,canvas.height=this.height;t.drawImage(f,0,0);i.find(".loading").addClass("active");i.find(".loading").toggleClass("active",!1)};f.src=s.Posters&&s.Posters[0]||"http://grayyoung.github.io/Flickr/poster/"+s.Title+".jpg";e.preventDefault()}).on("scroll.ls.media",function(t){e.throttle(i)}).ready(function(){var i=a("#containerListing"),s={pageSize:20},r=e.getUrlParam("t",!0),d=function(e){var t=e&&e.Sheets[e.SheetNames[0]]||i.data("sheet"),n=i.data("offset")||2,d=a("#fixedProgress"),c=(a(".progress-label",d),function(e){var t=a("#fixedProgress"),o=a(".progress-label",t),r=a(document.getElementById("tl-preview").content).children().clone().data({imdbData:e,page:parseInt(n/s.pageSize,10)+1});r.find(".p-category").children().first().text(e.Type).end().last().text(e.Genre);r.find("img").attr("src",e.Poster);r.find(".p-name").children().text(e.Title);r.find(".p-rating").children().first().css("width",e.imdbRating+"em").next().children().first().text(e.imdbRating).next().text(e.imdbVotes);r.find(".u-url").attr("href","http://www.imdb.com/title/"+e.imdbID);i.append(r);o.text(parseInt(o.text(),10)+1);window.parent.postMessage({docHeight:a(document).height()},"*")});i.data("sheet",t);if(window.Worker){var l=new Worker("/js/app/worker/ajaxToIMDB.js");l.onmessage=function(e){if(1===e.data.status)l.postMessage({sheet:t,offset:n,setting:s,type:r});else if(e.data.offset){c(e.data.media);i.data("offset",e.data.offset)}else if(e.data.pause===!0){i.data("loading",!1);d.toggleClass("loading",!1)}else if(e.data.stopProgress===!0){i.data("loading",!1);d.toggleClass("loading",!1);a(document).off("scroll.ls.media mousewheel.ls.media touchstart.ls.media touchend.ls.media");i.unbind("update")}}}else o({sheet:t,offset:n,setting:s,type:r,pause:function(){i.data("loading",!1);d.toggleClass("loading",!1)},end:function(){i.data("loading",!1);d.toggleClass("loading",!1);a(document).off("scroll.ls.media mousewheel.ls.media touchstart.ls.media touchend.ls.media");i.unbind("update")},success:function(e){c(e.media);i.data("offset",e.offset)},error:function(e){c(e.media);i.data("offset",e.offset)}})};i.data({loading:!1});a("#containerListing").bind("update",function(e,o){var i=a(this),s=a("#fixedProgress");if(i.data("loading")===!0||"top"===o)return!1;i.data("loading",!0);s.toggleClass("loading",!0);if(i.data("sheet"))d();else if(window.Worker){var r=new Worker("/js/app/worker/xlsx.js");r.onmessage=function(e){d(e.data);r.terminate()};r.onerror=function(e){n("GET",t.media,d);r.terminate()}}else n("GET",t.media,d)});a(document).data("oddScrollTop",a(document).scrollTop()).trigger("scroll.ls.media")})})});define("../media",function(){});define("app/model/util",{getUrlParam:function(e,t){var n="";return n=function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");return t===!0&&(n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i")),location.search.substr(1).match(n)}(e),null!=n?unescape(n[2]):""},throttle:function(e,t){clearTimeout(e.timeoutId),e.timeoutId=setTimeout(function(){e.call(t)},100)}});define("app/model/excelRequest",[],function(){function e(){e="undefined"!=typeof XMLHttpRequest?function(){return new XMLHttpRequest}:"undefined"!=typeof ActiveXObject?function(){if("string"!=typeof arguments.callee.activeXString)for(var e=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp"],t=0,n=e.length;n>t;t++)try{var o=new ActiveXObject(e[t]);arguments.callee.activeXString=e[t];return o}catch(a){console.log("Failed to create XMLHttpRequest: "+e[t])}return new ActiveXObject(arguments.callee.activeXString)}:function(){throw new Error("No XHR object availabel.")};return e()}return function(t,n,o){var a=e();if("undefined"!=typeof Uint8Array){try{a.responseType="arraybuffer"}catch(i){console.log(i)}a.onload=function(e){var t,n=a.response,i=new Array;try{t=new Uint8Array(n);for(var s=0;s!=t.length;++s)i[s]=String.fromCharCode(t[s])}catch(r){console.log(r);t=new Uint8Array(n.length);for(var s=0;s!=n.length;++s){t[s]=n[s];i[s]=String.fromCharCode(t[s])}}o(XLSX.read(i.join(""),{type:"binary"}))}}else{a.setRequestHeader("Accept-Charset","x-user-defined");a.onreadystatechange=function(){4==a.readyState&&(a.status>=200&&a.status<=300||304==a.status?o(XLSX.read(a.responseBody,{type:"binary"})):console.log("Request was unsuccessful: "+a.status))}}a.open(t,n,!0);a.send();return a}});define("app/model/requests",{imdb:"http://www.omdbapi.com/",media:"/data/media.xlsx",work:"/data/work.xlsx"});!function(e,t){"use strict";"function"==typeof define&&define.amd?define("ajax",t):"object"==typeof exports?exports=module.exports=t():(e.Ajax=t(),e.ajax=t())}(this,function(){"use strict";function e(t){void 0!==this&&console.warn(["Instance with `new` is deprecated. ","This will be removed in `v2.0.0` version."].join("")),this instanceof e&&console.warn(["Ajax constructor is deprecated. This will be removed in ","`v2.0.0`. Use ajax (lowercase version) without `new` ","keyword instead"].join("")),t=t||{};var n={},o={};return o.methods={then:function(){},"catch":function(){},always:function(){},done:function(){},error:function(){}},o.maybeData=function(e){return e||null},o.httpMethods=["get","post","put","delete"],o.httpMethods.forEach(function(e){n[e]=function(n,a){return o.xhrConnection(e,n,o.maybeData(a),t)}}),o.xhrConnection=function(e,t,n,a){var i=new XMLHttpRequest;return i.open(e,t||"",!0),o.setHeaders(i,a.headers),i.addEventListener("readystatechange",o.ready,!1),i.send(o.objectToQueryString(n)),o.promises()},o.setHeaders=function(e,t){t=t||{},o.hasContentType(t)||(t["Content-Type"]="application/x-www-form-urlencoded"),Object.keys(t).forEach(function(n){t[n]&&e.setRequestHeader(n,t[n])})},o.hasContentType=function(e){return Object.keys(e).some(function(e){return"content-type"===e.toLowerCase()})},o.ready=function(){var e=this;e.readyState===e.DONE&&(e.removeEventListener("readystatechange",o.ready,!1),o.methods.always.apply(o.methods,o.parseResponse(e)),e.status>=200&&e.status<300?(o.methods.then.apply(o.methods,o.parseResponse(e)),o.methods.done.apply(o.methods,o.parseResponse(e))):(o.methods["catch"].apply(o.methods,o.parseResponse(e)),o.methods.error.apply(o.methods,o.parseResponse(e))))},o.parseResponse=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return[t,e]},o.promises=function(){var e={};return Object.keys(o.methods).forEach(function(t){e[t]=o.generatePromise.call(this,t)},this),e},o.generatePromise=function(e){return function(t){return o.generateDeprecatedMessage(e),o.methods[e]=t,this}},o.generateDeprecatedMessage=function(e){var t="@fdaciuk/ajax: `%s` is deprecated and will be removed in v2.0.0. Use `%s` instead.";switch(e){case"done":console.warn(t,"done","then");break;case"error":console.warn(t,"error","catch")}},o.objectToQueryString=function(e){return o.isObject(e)?o.getQueryString(e):e},o.getQueryString=function(e){return Object.keys(e).map(function(t){return[encodeURIComponent(t),"=",encodeURIComponent(e[t])].join("")}).join("&")},o.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.method&&t.url?o.xhrConnection(t.method,t.url,o.maybeData(t.data),t):n}return e});define("app/model/iterateMedia",["app/model/requests","ajax"],function(e,t){var n,o,a,i,s=1;return function(){a=arguments[0],i=arguments.callee;if("undefined"==typeof a)throw new Error("no parameter be defiended.");"undefined"==typeof n&&(n=new RegExp("^\\s*"+a.type+"\\s*$","i"));"function"==typeof a.init&&a.init();o={Title:a.sheet["A"+a.offset]&&a.sheet["A"+a.offset].v,imdbID:a.sheet["B"+a.offset]&&a.sheet["B"+a.offset].v,Type:a.sheet["C"+a.offset]&&a.sheet["C"+a.offset].v,PosterList:a.sheet["D"+a.offset]&&a.sheet["D"+a.offset].v};if("undefined"==typeof o.Title&&"undefined"==typeof o.imdbID){"function"==typeof a.end&&a.end();s=null,o=null,n=null;return!1}if(s>a.setting.pageSize){"function"==typeof a.pause&&a.pause();s=1;return!0}delete a.sheet["A"+a.offset];delete a.sheet["B"+a.offset];delete a.sheet["C"+a.offset];delete a.sheet["D"+a.offset];a.offset++;if(""===a.type||n.test(o.Type)){if(o.imdbID)t().get(e.imdb+"?i="+o.imdbID+"&plot=full&r=json").then(function(e,t){o&&o.PosterList&&(e.Posters=o.PosterList.split(","));"function"==typeof a.success&&a.success({media:e,offset:a.offset})})["catch"](function(e,t){"function"==typeof a.error&&a.error({media:o,offset:a.offset})}).always(function(e,t){"function"==typeof a.complete&&a.complete({media:o,offset:a.offset});i(a)});else{"function"==typeof a.error&&a.error({media:o,offset:a.offset});i(a)}s++}else i(a)}});define("app/controller/global",["app/model/requests","jquery","bootstrap","browser"],function(e,t){t(document).ready(function(){t("#progressBar").toggleClass("active",!1),t.browser.msie?t("#tip-browser").removeClass("hidden"):t("#tip-browser").remove()}),!function(e,t,n,o,a,i,s){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,i=t.createElement(n),s=t.getElementsByTagName(n)[0],i.async=1,i.src=o,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-51330074-5","auto"),ga("require","linkid"),ga("send","pageview")});